<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PSYC 318 Study Assistant</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --purple:    #7c3aed;
      --purple-lt: #a78bfa;
      --purple-bg: #f5f0ff;
      --teal:      #0d9488;
      --teal-lt:   #5eead4;
      --teal-bg:   #f0fdfa;
      --rose:      #e11d48;
      --rose-lt:   #fda4af;
      --rose-bg:   #fff1f2;
      --amber:     #d97706;
      --amber-lt:  #fcd34d;
      --amber-bg:  #fffbeb;
      --sky:       #0284c7;
      --sky-lt:    #7dd3fc;
      --sky-bg:    #f0f9ff;
      --text:      #1e1b4b;
      --text-mid:  #4c1d95;
      --text-soft: #6b7280;
      --bg:        #faf5ff;
      --white:     #ffffff;
      --border:    #e9d5ff;
      --shadow:    rgba(124,58,237,0.12);
    }

    body {
      font-family: 'Nunito', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      background-image:
        radial-gradient(ellipse at 0% 0%, rgba(167,139,250,0.18) 0%, transparent 55%),
        radial-gradient(ellipse at 100% 100%, rgba(94,234,212,0.15) 0%, transparent 55%);
    }

    .app-shell {
      width: 100%;
      max-width: 780px;
      background: var(--white);
      border-radius: 24px;
      box-shadow: 0 8px 48px var(--shadow), 0 1px 3px rgba(0,0,0,0.06);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 90vh;
      border: 1.5px solid var(--border);
    }

    /* â”€â”€ Header â”€â”€ */
    .header {
      background: linear-gradient(135deg, #6d28d9 0%, #7c3aed 40%, #0d9488 100%);
      padding: 22px 26px 20px;
      position: relative;
      overflow: hidden;
    }
    .header::before {
      content: '';
      position: absolute;
      top: -30px; right: -30px;
      width: 160px; height: 160px;
      border-radius: 50%;
      background: rgba(255,255,255,0.07);
    }
    .header::after {
      content: '';
      position: absolute;
      bottom: -40px; left: 30%;
      width: 120px; height: 120px;
      border-radius: 50%;
      background: rgba(255,255,255,0.05);
    }
    .header-top {
      display: flex;
      align-items: center;
      gap: 13px;
      margin-bottom: 8px;
      position: relative; z-index: 1;
    }
    .header-icon {
      width: 46px; height: 46px;
      background: rgba(255,255,255,0.2);
      border-radius: 14px;
      display: flex; align-items: center; justify-content: center;
      font-size: 22px;
      backdrop-filter: blur(4px);
      border: 1.5px solid rgba(255,255,255,0.3);
    }
    .header-title {
      font-family: 'Lora', serif;
      font-size: 22px;
      font-weight: 600;
      color: #fff;
      letter-spacing: 0.01em;
    }
    .header-subtitle {
      font-size: 11.5px;
      color: rgba(255,255,255,0.7);
      margin-top: 1px;
      letter-spacing: 0.03em;
    }
    .header-badge {
      margin-left: auto;
      background: rgba(255,255,255,0.15);
      border: 1px solid rgba(255,255,255,0.25);
      border-radius: 20px;
      padding: 4px 11px;
      font-size: 11px;
      color: rgba(255,255,255,0.85);
      letter-spacing: 0.05em;
      backdrop-filter: blur(4px);
    }
    .header-desc {
      font-size: 13.5px;
      color: rgba(255,255,255,0.85);
      line-height: 1.55;
      position: relative; z-index: 1;
      max-width: 580px;
    }

    /* â”€â”€ Quick actions â”€â”€ */
    .quick-panel {
      padding: 16px 20px;
      background: #fdfaff;
      border-bottom: 1.5px solid var(--border);
    }
    .quick-label {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.1em;
      color: var(--purple);
      text-transform: uppercase;
      margin-bottom: 11px;
    }
    .quick-cols {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .quick-group h4 {
      font-size: 10.5px;
      font-weight: 800;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      margin-bottom: 7px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .quick-group.info h4 { color: var(--sky); }
    .quick-group.study h4 { color: var(--teal); }

    .quick-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      padding: 8px 11px;
      border-radius: 10px;
      border: 1.5px solid transparent;
      cursor: pointer;
      font-family: 'Nunito', sans-serif;
      font-size: 13px;
      font-weight: 600;
      text-align: left;
      transition: all 0.15s ease;
      margin-bottom: 6px;
    }
    .quick-btn:last-child { margin-bottom: 0; }
    .quick-btn.info {
      background: var(--sky-bg);
      color: var(--sky);
      border-color: #bae6fd;
    }
    .quick-btn.info:hover {
      background: #e0f2fe;
      border-color: var(--sky-lt);
      transform: translateY(-1px);
      box-shadow: 0 3px 10px rgba(2,132,199,0.15);
    }
    .quick-btn.study {
      background: var(--teal-bg);
      color: var(--teal);
      border-color: #99f6e4;
    }
    .quick-btn.study:hover {
      background: #ccfbf1;
      border-color: var(--teal-lt);
      transform: translateY(-1px);
      box-shadow: 0 3px 10px rgba(13,148,136,0.15);
    }
    .quick-btn .btn-icon { font-size: 15px; flex-shrink: 0; }

    /* â”€â”€ Chat area â”€â”€ */
    .chat-area {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      min-height: 280px;
      background: var(--white);
    }
    .chat-area::-webkit-scrollbar { width: 5px; }
    .chat-area::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

    .empty-state {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 10px;
      color: var(--text-soft);
    }
    .empty-icon { font-size: 36px; opacity: 0.4; }
    .empty-text { font-size: 13.5px; opacity: 0.6; }

    .bubble-row {
      display: flex;
      gap: 10px;
      align-items: flex-start;
      animation: slideUp 0.2s ease forwards;
    }
    .bubble-row.user { flex-direction: row-reverse; }

    .avatar {
      width: 30px; height: 30px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 14px;
      flex-shrink: 0;
    }
    .avatar.bot {
      background: linear-gradient(135deg, #7c3aed, #0d9488);
      box-shadow: 0 2px 8px rgba(124,58,237,0.3);
    }
    .avatar.user-av {
      background: linear-gradient(135deg, #e11d48, #d97706);
    }

    .bubble {
      max-width: 74%;
      padding: 10px 14px;
      border-radius: 4px 16px 16px 16px;
      font-size: 14px;
      line-height: 1.65;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .bubble.bot {
      background: #faf5ff;
      color: var(--text);
      border: 1.5px solid var(--border);
      border-radius: 4px 16px 16px 16px;
    }
    .bubble.user {
      background: linear-gradient(135deg, #7c3aed, #6d28d9);
      color: #fff;
      border-radius: 16px 4px 16px 16px;
      box-shadow: 0 3px 12px rgba(124,58,237,0.25);
    }

    .file-chip {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      background: rgba(255,255,255,0.2);
      border-radius: 6px;
      padding: 3px 8px;
      font-size: 11.5px;
      margin-bottom: 6px;
      color: rgba(255,255,255,0.9);
    }

    .typing-dots {
      display: flex;
      gap: 5px;
      align-items: center;
      padding: 12px 14px;
    }
    .dot {
      width: 7px; height: 7px;
      border-radius: 50%;
      background: var(--purple-lt);
      animation: bounce 1.1s ease infinite;
    }
    .dot:nth-child(2) { animation-delay: 0.18s; }
    .dot:nth-child(3) { animation-delay: 0.36s; }

    /* â”€â”€ File attach preview â”€â”€ */
    .attach-chip {
      display: inline-flex;
      align-items: center;
      gap: 7px;
      background: var(--purple-bg);
      border: 1.5px solid var(--border);
      border-radius: 8px;
      padding: 5px 10px;
      font-size: 12.5px;
      color: var(--purple);
      font-weight: 600;
      margin: 8px 20px 0;
    }
    .attach-chip button {
      background: none; border: none; cursor: pointer;
      color: var(--purple-lt); font-size: 16px; line-height: 1;
      padding: 0 2px;
    }

    /* â”€â”€ Input bar â”€â”€ */
    .input-bar {
      padding: 12px 16px 16px;
      border-top: 1.5px solid var(--border);
      background: #fdfaff;
    }
    .input-row {
      display: flex;
      align-items: flex-end;
      gap: 9px;
      background: var(--white);
      border: 2px solid var(--border);
      border-radius: 16px;
      padding: 8px 10px;
      transition: border-color 0.2s;
    }
    .input-row:focus-within {
      border-color: var(--purple-lt);
      box-shadow: 0 0 0 3px rgba(124,58,237,0.08);
    }
    .attach-btn {
      background: none; border: none; cursor: pointer;
      color: var(--purple-lt);
      padding: 5px;
      border-radius: 8px;
      display: flex; align-items: center;
      transition: color 0.15s, background 0.15s;
      flex-shrink: 0;
    }
    .attach-btn:hover {
      color: var(--purple);
      background: var(--purple-bg);
    }
    #chat-input {
      flex: 1;
      border: none;
      outline: none;
      font-family: 'Nunito', sans-serif;
      font-size: 14px;
      color: var(--text);
      background: none;
      resize: none;
      line-height: 1.5;
      padding: 4px 0;
      max-height: 110px;
      overflow-y: auto;
    }
    #chat-input::placeholder { color: #c4b5fd; }
    .send-btn {
      background: linear-gradient(135deg, #7c3aed, #6d28d9);
      border: none;
      border-radius: 11px;
      padding: 9px 11px;
      cursor: pointer;
      color: #fff;
      display: flex; align-items: center;
      flex-shrink: 0;
      transition: all 0.15s;
      box-shadow: 0 3px 10px rgba(124,58,237,0.3);
    }
    .send-btn:hover:not(:disabled) {
      background: linear-gradient(135deg, #6d28d9, #5b21b6);
      transform: translateY(-1px);
      box-shadow: 0 5px 14px rgba(124,58,237,0.35);
    }
    .send-btn:disabled {
      background: #e9d5ff;
      color: #c4b5fd;
      box-shadow: none;
      cursor: not-allowed;
    }
    .input-footer {
      text-align: center;
      font-size: 11px;
      color: #c4b5fd;
      margin-top: 8px;
    }

    @keyframes bounce {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-5px); }
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 540px) {
      .quick-cols { grid-template-columns: 1fr; }
      .bubble { max-width: 88%; }
      .header-badge { display: none; }
    }
  </style>
</head>
<body>
<div class="app-shell">

  <!-- Header -->
  <div class="header">
    <div class="header-top">
      <div class="header-icon">ğŸ§ </div>
      <div>
        <div class="header-title">PSYC 318 Study Assistant</div>
        <div class="header-subtitle">Cognitive Psychology Â· University of Kansas</div>
      </div>
      <div class="header-badge">SOCRATIC MODE</div>
    </div>
    <div class="header-desc">
      I'm your Cognitive Psychology study companion. I can help you think through concepts, find due dates, and understand course policies. I won't give you answers â€” but I will help you find them!
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-panel">
    <div class="quick-label">Try asking me about:</div>
    <div class="quick-cols">
      <div class="quick-group info">
        <h4>ğŸ“‹ Course Information</h4>
        <button class="quick-btn info" onclick="quickAsk('What assignments are due this week?')">
          <span class="btn-icon">ğŸ“…</span> Due dates
        </button>
        <button class="quick-btn info" onclick="quickAsk('What are the course policies I should know about?')">
          <span class="btn-icon">ğŸ“„</span> Course policies
        </button>
        <button class="quick-btn info" onclick="quickAsk('What chapters are we reading this module?')">
          <span class="btn-icon">ğŸ“š</span> Reading assignments
        </button>
      </div>
      <div class="quick-group study">
        <h4>ğŸ”¬ Study Assistance</h4>
        <button class="quick-btn study" onclick="quickAsk('Can you help me understand a concept from class?')">
          <span class="btn-icon">ğŸ’¡</span> Explain a concept
        </button>
        <button class="quick-btn study" onclick="quickAsk('Can you give me a practice quiz on the current module?')">
          <span class="btn-icon">âœï¸</span> Practice quiz
        </button>
        <button class="quick-btn study" onclick="quickAsk('Can you help me think through how to approach my assignment?')">
          <span class="btn-icon">ğŸ§©</span> How to approach a topic
        </button>
        <button class="quick-btn study" onclick="quickAsk('I have a draft I\'d like feedback on.')">
          <span class="btn-icon">ğŸ“</span> Review my draft
        </button>
      </div>
    </div>
  </div>

  <!-- File chip (shown when file attached) -->
  <div id="attach-preview" class="attach-chip" style="display:none;">
    <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/></svg>
    <span id="attach-name"></span>
    <button onclick="clearAttach()">Ã—</button>
  </div>

  <!-- Chat -->
  <div class="chat-area" id="chat-area">
    <div class="empty-state" id="empty-state">
      <div class="empty-icon">ğŸ’¬</div>
      <div class="empty-text">Ask a question or choose a topic above to get started.</div>
    </div>
  </div>

  <!-- Input -->
  <div class="input-bar">
    <div class="input-row">
      <input type="file" id="file-input" accept=".txt,.pdf,.doc,.docx,.md" style="display:none" onchange="handleFile(event)" />
      <button class="attach-btn" onclick="document.getElementById('file-input').click()" title="Attach a draft or file">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
        </svg>
      </button>
      <textarea id="chat-input" rows="1" placeholder="Ask me anything about the courseâ€¦"
        onkeydown="handleKey(event)"
        oninput="autoResize(this)"></textarea>
      <button class="send-btn" id="send-btn" onclick="sendMessage()" disabled>
        <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <line x1="22" y1="2" x2="11" y2="13"/>
          <polygon points="22,2 15,22 11,13 2,9"/>
        </svg>
      </button>
    </div>
    <div class="input-footer">
      This assistant uses the Socratic method â€” it guides your thinking, not your answers. It will not discuss grades.
    </div>
  </div>
</div>

<script>
// â”€â”€ Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const WORKER_URL = "https://dbward2119.workers.dev";

// â”€â”€ Course Knowledge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SYSTEM_PROMPT = `You are a Socratic tutoring assistant for PSYC 318 â€“ Cognitive Psychology at the University of Kansas. You help undergraduate students learn and understand course concepts using the Socratic method: you guide students to discover answers through thoughtful questioning rather than providing direct answers.

COURSE: PSYC 318 â€“ Cognitive Psychology
TERM: Spring-1 2024 (January 16 â€“ March 8, 2024)
FORMAT: 8-week, 3-credit, fully asynchronous online course
PLATFORM: Canvas (canvas.ku.edu)
TEXTBOOK: Juola & Koshino (2022), Cognitive Psychology (4th ed.), BVT Publishing â€” LabBook eBook, $25

LEARNING OUTCOMES:
1. Develop a fundamental understanding of the sub-areas of cognitive psychology and how they overlap.
2. Acquire an understanding of the research methods used in cognitive psychology.
3. Think critically about cognitive psychology topics; practice written and oral discourse.
4. Apply cognitive psychology findings to everyday events: learning, memory, decision making, language.

GRADING SCALE: 90-100%=A | 87-89%=B+ | 80-86%=B | 77-79%=C+ | 70-76%=C | 67-69%=D+ | 60-66%=D | <60%=F

KEY DEADLINES:
- Last day to drop without a grade: January 25
- Last day to withdraw: February 29

COURSE POLICIES:
- All work due at 11:59pm Central Time on listed date
- Late work accepted but strongly discouraged â€” contact instructor immediately if deadline missed
- All submissions scanned by Turnitin for plagiarism and AI-generated text
- Academic misconduct includes sharing work or uploading to sites like Course Hero
- No required meeting times; participation shown through completing assignments on time
- Disabilities: Student Access Center, 22 Strong Hall, 785-864-4064, http://access.ku.edu/

COURSE SCHEDULE:

MODULE 1 (Week of 1/16) â€” Introduction to Cognitive Psychology
  Readings: Ch. 1 (1.1, 1.5, 1.6), Ch. 2 (2.5, 2.6, 2.7)
  DB-1 post: Thu 1/19 | DB-1 reply: Fri 1/20 | Assign-1: Fri 1/20 | Quiz-1: Fri 1/20

MODULE 2 (Week of 1/23) â€” Sensation & Perception + Speech Perception
  Readings: Ch. 2 (2.2, 2.3, 2.8), Ch. 3 (3.1-3.5, 3.6c, 3.7d), Ch. 9 (9.2)
  DB-2 post: Wed 1/25 | DB-2 reply: Thu 1/26 | Assign-2: Fri 1/27 | Quiz-2: Fri 1/27 | UNIT 1 EXAM: Fri 1/27

MODULE 3 (Week of 1/30) â€” Attention
  Readings: Ch. 5 (5.1, 5.2, 5.3, 5.4a, 5.4b)
  DB-3 post: Wed 2/1 | DB-3 reply: Thu 2/2 | Assign-3: Fri 2/3 | Quiz-3: Fri 2/3

MODULE 4 (Week of 2/6) â€” Short-Term & Working Memory + Amnesia
  Readings: Ch. 5 (Sperling), Ch. 6 (6.1-6.7)
  DB-4 post: Wed 2/8 | DB-4 reply: Thu 2/9 | Assign-4: Fri 2/10 | Quiz-4: Fri 2/10 | UNIT 2 EXAM: Fri 2/10

MODULE 5 (Week of 2/13) â€” Long-Term Memory: Episodic, Semantic, Implicit
  Readings: Ch. 6 (6.6a), Ch. 7 (7.1, 7.2, 7.4, 7.7), Ch. 8 (8.1-8.5, 8.7)
  DB-5 post: Wed 2/15 | DB-5 reply: Thu 2/16 | Assign-5: Fri 2/17 | Quiz-5: Fri 2/17

MODULE 6 (Week of 2/20) â€” Imagery, Knowledge Representation & Memory Distortion
  Readings: Ch. 4 (4.1-4.5), Ch. 7 (7.6), Ch. 8 (8.6)
  DB-6 post: Wed 2/22 | DB-6 reply: Thu 2/23 | Assign-6: Fri 2/24 | Quiz-6: Fri 2/24 | UNIT 3 EXAM: Fri 2/24

MODULE 7 (Week of 2/27) â€” Language & Aphasia
  Readings: Ch. 9 (9.1, 9.3-9.5), Ch. 10 (10.1, 10.2, 10.10, 10.11), Ch. 2 (2.7c, 2.7d)
  DB-7 post: Wed 3/1 | DB-7 reply: Thu 3/2 | Assign-7: Fri 3/3 | Quiz-7: Fri 3/3

MODULE 8 (Week of 3/6) â€” Problem Solving, Reasoning & Decision Making
  Readings: Ch. 11 (11.1, 11.2, 11.4, 11.5)
  DB-8 post: Wed 3/8 | DB-8 reply: Thu 3/9 | DB-8 EXTRA CREDIT: Fri 3/10
  Assign-8: Fri 3/10 | Quiz-8: Fri 3/10 | UNIT 4 EXAM: Fri 3/10 | CLASS ENDS: Fri 3/10

CONTENT KNOWLEDGE â€” Key topics by module:
- Intro to Cog Psych: definition, history (structuralism, functionalism, behaviorism, cognitive revolution), key figures (Wundt, James, Watson, Chomsky, Miller), research methods
- Brain: neurons, neurotransmitters, brain regions (hippocampus, amygdala, PFC, Broca's area, Wernicke's area), imaging methods (fMRI, EEG, TMS, lesion studies)
- Sensation vs. Perception; signal detection theory; Gestalt principles; perceptual constancy; speech perception; categorical perception
- Attention: selective vs. divided; cocktail party effect (Cherry); dichotic listening; Broadbent's filter model; Treisman's attenuation model; Feature Integration Theory; exogenous vs. endogenous; automaticity; Stroop effect
- Sensory Memory: iconic/echoic memory; Sperling's partial report experiment
- Short-Term Memory: capacity (Miller's 7Â±2); duration; chunking; serial position effect (primacy & recency)
- Working Memory (Baddeley): phonological loop; visuospatial sketchpad; central executive; episodic buffer
- Long-Term Memory: explicit (declarative) vs. implicit; episodic vs. semantic; Levels of Processing (Craik & Lockhart); encoding specificity; spacing effect; self-reference effect; tip-of-the-tongue
- Amnesia: anterograde vs. retrograde; H.M. case study; hippocampus role
- Imagery & Knowledge Representation: mental rotation (Shepard & Metzler); propositional vs. analogical; schemas; scripts; prototypes; categorization
- Memory Distortion: Loftus misinformation effect; eyewitness testimony; DRM paradigm; source monitoring
- Language: phonemes, morphemes, syntax, semantics, pragmatics; Broca's aphasia; Wernicke's aphasia; reading models
- Problem Solving: algorithms vs. heuristics; means-ends analysis; mental set; insight; functional fixedness
- Reasoning: deductive vs. inductive; syllogistic reasoning; confirmation bias; Wason selection task
- Decision Making: availability heuristic; representativeness heuristic; anchoring; prospect theory; framing effects; decision fatigue

BEHAVIORAL RULES:
1. SOCRATIC APPROACH: Never directly answer content/concept questions. Ask probing questions to guide the student. Break complex topics into steps. Example: if asked "What is working memory?" ask "What do you think the word 'working' implies about this type of memory? How might it differ from just storing information?"
2. LOGISTICS: Directly and helpfully answer questions about due dates, schedule, policies, textbook chapters, assignment types.
3. GRADES: NEVER discuss, speculate about, or help calculate grades. Respond: "I'm not able to discuss grades â€” please reach out to your instructor directly through Canvas or email."
4. NO CHEATING: Never complete assignments, write papers, answer exam/quiz questions, or write discussion posts for students. Say: "My role is to help you learn, not do the work for you â€” but I'm happy to guide you through the thinking."
5. DRAFT FEEDBACK: If student shares a draft, ask what they're trying to argue, point out unclear areas with questions, guide their thinking â€” never rewrite for them.
6. STUDY AIDS: Can create practice quiz questions, suggest study strategies, compare/contrast concepts when asked.
7. TONE: Professional, patient, encouraging, direct. No "Great question!" praise. Treat students as capable adults.
8. SCOPE: Stay focused on course-relevant topics.`;

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let conversationHistory = [];
let attachedFile = null;
let attachedFileContent = "";
let isLoading = false;

// â”€â”€ File handling â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleFile(e) {
  const file = e.target.files[0];
  if (!file) return;
  attachedFile = file;
  const reader = new FileReader();
  reader.onload = ev => { attachedFileContent = ev.target.result; };
  reader.readAsText(file);
  document.getElementById("attach-name").textContent = file.name;
  document.getElementById("attach-preview").style.display = "inline-flex";
  updateSendBtn();
}

function clearAttach() {
  attachedFile = null;
  attachedFileContent = "";
  document.getElementById("attach-preview").style.display = "none";
  document.getElementById("file-input").value = "";
  updateSendBtn();
}

// â”€â”€ Input helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function autoResize(el) {
  el.style.height = "auto";
  el.style.height = Math.min(el.scrollHeight, 110) + "px";
  updateSendBtn();
}

function updateSendBtn() {
  const val = document.getElementById("chat-input").value.trim();
  document.getElementById("send-btn").disabled = isLoading || (!val && !attachedFile);
}

function handleKey(e) {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
}

function quickAsk(text) {
  document.getElementById("chat-input").value = text;
  autoResize(document.getElementById("chat-input"));
  sendMessage();
}

// â”€â”€ Render helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function hideEmpty() {
  const e = document.getElementById("empty-state");
  if (e) e.style.display = "none";
}

function appendBubble(role, content, fileName) {
  hideEmpty();
  const area = document.getElementById("chat-area");

  const row = document.createElement("div");
  row.className = "bubble-row " + (role === "user" ? "user" : "");

  const av = document.createElement("div");
  av.className = "avatar " + (role === "user" ? "user-av" : "bot");
  av.textContent = role === "user" ? "ğŸ‘¤" : "ğŸ§ ";

  const bubble = document.createElement("div");
  bubble.className = "bubble " + (role === "user" ? "user" : "bot");

  if (fileName) {
    const chip = document.createElement("div");
    chip.className = "file-chip";
    chip.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/></svg> ${fileName}`;
    bubble.appendChild(chip);
  }

  const text = document.createElement("span");
  text.textContent = content;
  bubble.appendChild(text);

  row.appendChild(av);
  row.appendChild(bubble);
  area.appendChild(row);
  area.scrollTop = area.scrollHeight;
  return bubble;
}

function showTyping() {
  hideEmpty();
  const area = document.getElementById("chat-area");
  const row = document.createElement("div");
  row.className = "bubble-row";
  row.id = "typing-row";

  const av = document.createElement("div");
  av.className = "avatar bot";
  av.textContent = "ğŸ§ ";

  const bubble = document.createElement("div");
  bubble.className = "bubble bot";
  bubble.innerHTML = '<div class="typing-dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>';

  row.appendChild(av);
  row.appendChild(bubble);
  area.appendChild(row);
  area.scrollTop = area.scrollHeight;
}

function removeTyping() {
  const t = document.getElementById("typing-row");
  if (t) t.remove();
}

// â”€â”€ Send â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function sendMessage() {
  const inputEl = document.getElementById("chat-input");
  const text = inputEl.value.trim();
  if ((!text && !attachedFile) || isLoading) return;

  isLoading = true;
  updateSendBtn();

  // Show user bubble
  const displayText = text || "(File attached)";
  appendBubble("user", displayText, attachedFile?.name);

  // Build API content
  let apiContent = text;
  if (attachedFile && attachedFileContent) {
    apiContent = (text ? text + "\n\n" : "") + `[Attached file: ${attachedFile.name}]\n\n${attachedFileContent}`;
  }

  conversationHistory.push({ role: "user", content: apiContent || displayText });

  // Clear inputs
  inputEl.value = "";
  inputEl.style.height = "auto";
  clearAttach();
  updateSendBtn();

  showTyping();

  try {
    const response = await fetch(WORKER_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        model: "claude-opus-4-5",
        max_tokens: 1024,
        system: SYSTEM_PROMPT,
        messages: conversationHistory
      })
    });

    const data = await response.json();
    removeTyping();

    const reply = data.content?.map(b => b.text || "").join("") ||
      "I'm sorry, I had trouble generating a response. Please try again.";

    conversationHistory.push({ role: "assistant", content: reply });
    appendBubble("assistant", reply);
  } catch (err) {
    removeTyping();
    appendBubble("assistant", "I'm having trouble connecting right now. Please check your connection and try again.");
  }

  isLoading = false;
  updateSendBtn();
}

// Init send button state
document.getElementById("chat-input").addEventListener("input", updateSendBtn);
</script>
</body>
</html>